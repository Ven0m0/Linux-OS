

WIP minifier:

```bash
awk 'BEGIN{FS=" +";placeholder="\033";align_all_columns=z_get_var(align_all_columns,0);align_columns_if_first_matches=align_all_columns?0:z_get_var(align_columns_if_first_matches,0);align_columns=align_all_columns||align_columns_if_first_matches;align_comments=z_get_var(align_comments,1);comment_regex=align_comments?z_get_var(comment_regex,"[#;]"):""}/^[[:blank:]]*$/{if(!last_empty){c_print_section();if(output_lines){empty_pending=1}}last_empty=1;next}{sub(/^ +/,"",$0);if(empty_pending){print"";empty_pending=0}last_empty=0;if(align_columns_if_first_matches&&actual_lines&&(!comment_regex||$1!~"^"comment_regex"([^[:blank:]]|$)")&&$1!=setting){b_queue_entries()}entry_line++;section_line++;field_count[entry_line]=0;comment[section_line]="";for(i=1;i<=NF;i++){if(a_process_regex("[\"'\\\\]","(([^ \"'\''\\\\]|\\\\.)*(\"([^\"]|\\\\\")*\"|'\''([^'\'']|\\\\\\')*'\''))*([^ \\\\]|\\\\.|\\\\$)*")){a_store_field(field_value)}else if(comment_regex&&(a_process_regex(comment_regex,comment_regex".*",1))){sub(/ +$/,"",field_value);comment[section_line]=field_value}else if(length($i)){a_store_field($i"");a_replace_field(placeholder)}}if(field_count[entry_line]){if(!actual_lines){setting=entry[entry_line,1]}actual_lines++}}END{c_print_section()}function a_process_regex(r,v,s,_p,_d){if(match($i,r)){if(s&&RSTART>1){a_replace_field(substr($i,1,RSTART-1)" "substr($i,RSTART));return}_p=$0;sub("^( |"placeholder")*","",_p);if(match(_p,"^"v)){field_value=substr(_p,RSTART,RLENGTH);_d=length($0)-length(_p);$0=substr($0,1,RSTART-1+_d)placeholder substr($0,RSTART+RLENGTH+_d);return 1}}}function a_replace_field(v,_n){if(!match($0,"^ *[^ ]+( +[^ ]+){"(i-1)"}")){$i=v;return}_n=substr($0,RLENGTH+1);$0=substr($0,1,RLENGTH);$i="";$0=$0 v _n}function a_store_field(v,_l){field_count[entry_line]=i;entry[entry_line,i]=v;_l=length(v);field_width[i]=_l>field_width[i]?_l:field_width[i]}function b_queue_entries(_o,_i,_j,_l){_o=section_line-entry_line;for(_i=1;_i<=entry_line;_i++){_l="";for(_j=1;_j<=field_count[_i];_j++){if(align_columns&&actual_lines>1&&setting){_l=_l sprintf("%-"field_width[_j]"s ",entry[_i,_j])}else{_l=_l sprintf("%s ",entry[_i,_j])}}sub(" $","",_l);section[_o+_i]=_l}entry_line=0;actual_lines=0;for(_j in field_width){delete field_width[_j]}}function c_print_section(_i,_len,_max,_l){b_queue_entries();for(_i=1;_i<=section_line;_i++){_len=length(section[_i]);_max=_len>_max?_len:_max}for(_i=1;_i<=section_line;_i++){_l=section[_i];if(comment[_i]){_l=(_l~/[^\t]/?sprintf("%-"_max"s ",_l):_l)comment[_i]}print _l;output_lines++}section_line=0}function z_get_var(v,d){return z_is_set(v)?v:d}function z_is_set(v){return!(v==""&&v==0)}'
```
