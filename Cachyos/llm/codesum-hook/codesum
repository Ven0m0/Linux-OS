#!/usr/bin/env bash
# shellcheck enable=all shell=bash
set -euo pipefail
shopt -s nullglob

# Enhanced CodeSum CLI wrapper

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
CODESUM="${SCRIPT_DIR}/codesum.py"

has(){ command -v -- "$1" &>/dev/null; }
die(){ printf '%s\n' "$@" >&2; exit 1; }

[[ -x "$CODESUM" ]] || die "Error: $CODESUM not executable"
has python3 || die "Error: python3 not found"

# Quick aliases
case "${1:-}" in
  openai|gpt) shift; exec python3 "$CODESUM" "${1:-.}" -c --llm openai "$@" ;;
  gemini|gem) shift; exec python3 "$CODESUM" "${1:-.}" -c --llm gemini "$@" ;;
  claude|ant) shift; exec python3 "$CODESUM" "${1:-.}" -c --llm claude "$@" ;;
  trace|tb) shift; 
    [[ -n "${1:-}" ]] || die "Usage: codesum trace <project> [traceback]"
    PROJECT="$1"; shift
    TB="${*:-$(cat)}"
    exec python3 "$CODESUM" "$PROJECT" -t "$TB" ;;
  repo|remote) shift;
    [[ -n "${1:-}" ]] || die "Usage: codesum repo <github-url>"
    exec python3 "$CODESUM" "$1" -c "${@:2}" ;;
  *) exec python3 "$CODESUM" "$@" ;;
esac
