# Skip if not interactive shell
[[ $- != *i* ]] && return

# https://github.com/iffse/pay-respects
eval "$(pay-respects bash --alias)"
eval "$(fzf --bash)"

## GENERAL OPTIONS ##

# Disable unicode.
# export LC_ALL=C
# export LANG=C
export LC_ALL=C.UTF-8
export LANG=C.UTF-8

export PAGER=less
export LESS='-FRXn'
export MANPAGER="less -sRn"

# Malloc tweak
export MALLOC_CONF="thp:always,metadata_thp:always"

# History tweaks
export HISTCONTROL="erasedups:ignoreboth"
shopt -s histappend          # append to history, don't overwrite
HISTSIZE=1000
HISTFILESIZE=2000
# Don't record some commands
export HISTIGNORE="&:[ ]*:exit:ls:bg:fg:history:clear"

alias cleanmem='sync; echo 3 | sudo tee /proc/sys/vm/drop_caches'
# alias parallel='parallel -j 0 --load 75% --fast --pipe-part'

export EDITOR='micro'
alias editor='micro'

alias sshdb='dbclient'
alias ptch='patch -p1 <'
alias cleansh='curl -fsSL https://raw.githubusercontent.com/Ven0m0/Linux-OS/refs/heads/main/Cachyos/Updates.sh | bash'
alias updatesh='curl -fsSL https://raw.githubusercontent.com/Ven0m0/Linux-OS/refs/heads/main/Cachyos/Clean.sh | bash'

alias ls='eza -al --color=always --group-directories-first --icons' # preferred listing
alias la='eza -a --color=always --group-directories-first --icons'  # all files and dirs
alias ll='eza -l --color=always --group-directories-first --icons'  # long format
alias lt='eza -aT --color=always --group-directories-first --icons' # tree listing
alias l.="eza -a | grep -e '^\.'"                                   # show only dotfiles
alias cat='bat --strip-ansi=auto'
# alias du='dust -T 16 -b -P'

# Better sudo
if command -v sudo-rs >/dev/null 2>&1; then
  alias sudo='sudo-rs'
  alias su='su-rs'
fi

# Ripgrep
if command -v rg >/dev/null 2>&1; then
    alias rg='rg --no-stats --color=auto'
    alias grep='rg -uuu --no-stats --color=auto'
    alias fgrep='rg -uuu --no-stats --color=auto -E UTF-8'
    alias egrep='rg --no-stats --color=auto'
else
    alias grep='grep --color=auto'
    alias fgrep='fgrep --color=auto'
    alias egrep='egrep --color=auto'
fi

# FD https://github.com/sharkdp/fd
export FZF_DEFAULT_COMMAND='fd --type file'
export FZF_CTRL_T_COMMAND="$FZF_DEFAULT_COMMAND"

## GENERAL OPTIONS ##

# Prevent file overwrite on stdout redirection
# Use `>|` to force redirection to an existing file
set -o noclobber

# Automatically trim long paths in the prompt (requires Bash 4.x)
export PROMPT_DIRTRIM=2

## SANE HISTORY DEFAULTS ##

# Save multi-line commands as one command
shopt -s cmdhist

# Avoid duplicate entries
export HISTCONTROL="erasedups:ignoreboth"

# Don't record some commands
export HISTIGNORE="&:[ ]*:exit:ls:bg:fg:history:clear"

# Use standard ISO 8601 timestamp
# %F equivalent to %Y-%m-%d
# %T equivalent to %H:%M:%S (24-hours format)
export HISTTIMEFORMAT='%F %T '

## BETTER DIRECTORY NAVIGATION ##

# Prepend cd to directory names automatically
shopt -s autocd 2> /dev/null
# Correct spelling errors during tab-completion
shopt -s dirspell 2> /dev/null
# Correct spelling errors in arguments supplied to cd
shopt -s cdspell 2> /dev/null

# This defines where cd looks for targets
# Add the directories you want to have fast access to, separated by colon
# Ex: CDPATH=".:~:~/projects" will look for targets in the current working directory, in home and in the ~/projects folder
export CDPATH="."

# This allows you to bookmark your favorite places across the file system
# Define a variable containing a path and you will be able to cd into it regardless of the directory you're in
shopt -s cdable_vars

# Examples:
# export dotfiles="$HOME/dotfiles"
# export projects="$HOME/projects"
# export documents="$HOME/Documents"
# export dropbox="$HOME/Dropbox"

# Add tab completion for SSH hostnames based on ~/.ssh/config, ignoring wildcards
if [ -e "$HOME/.ssh/config" ]; then
  if command -v rg >/dev/null 2>&1; then
    hosts="$(rg --no-filename --no-heading -e '^Host\s+(?!.*[\?\*]).*' "$HOME/.ssh/config" | awk '{for(i=2;i<=NF;i++) print $i}')"
  else
    hosts="$(grep '^Host' "$HOME/.ssh/config" | grep -v '[?*]' | cut -d' ' -f2- | tr ' ' '\n')"
  fi

  complete -o default -o nospace -W "$hosts" ssh scp sftp
fi

# Deduplicate PATH (preserve order) â€” pure Bash (requires Bash 4+)
if [[ ${BASH_VERSINFO[0]} -ge 4 ]]; then
  IFS=: read -ra parts <<< "$PATH"
  declare -A seen
  newpath=()
  for dir in "${parts[@]}"; do
    [[ -n "$dir" && -z "${seen[$dir]}" ]] && newpath+=("$dir") && seen[$dir]=1
  done
  PATH="${newpath[*]}"
  PATH="${PATH// /:}"
  export PATH
else
  # Fallback: use awk one-liner if Bash <4
  export PATH="$(awk -v RS=: '!(seen[$1]++) {paths[++count]=$1} END {for(i=1;i<=count;i++) printf "%s%s", paths[i], (i<count ? ":" : "\n")}' <<<"$PATH")"
fi
